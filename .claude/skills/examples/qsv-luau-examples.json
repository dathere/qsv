{
  "skill": "qsv-luau",
  "version": "12.0.0",
  "examples": [
    {
      "name": "luau_map",
      "description": "Luau Map",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map inc number + 1 data.csv",
      "args": [
        "map",
        "inc",
        "number + 1",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter",
            "number",
            "inc"
          ],
          [
            "a",
            "13",
            "14"
          ],
          [
            "b",
            "24",
            "25"
          ],
          [
            "c",
            "72",
            "73"
          ],
          [
            "d",
            "7",
            "8"
          ]
        ]
      }
    },
    {
      "name": "luau_map_multiple_columns",
      "description": "Luau Map Multiple Columns",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map newcol1,newcol2,newcol3",
      "args": [
        "map",
        "newcol1,newcol2,newcol3"
      ]
    },
    {
      "name": "luau_map_idx",
      "description": "Luau Map Idx",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map inc number * _IDX data.csv",
      "args": [
        "map",
        "inc",
        "number * _IDX",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter",
            "number",
            "inc"
          ],
          [
            "a",
            "13",
            "13"
          ],
          [
            "b",
            "24",
            "48"
          ],
          [
            "c",
            "72",
            "216"
          ],
          [
            "d",
            "7",
            "28"
          ]
        ]
      }
    },
    {
      "name": "luau_aggregation",
      "description": "Luau Aggregation",
      "input": {
        "data": [
          [
            "letter",
            "Amount"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map Total tot = (tot or 0) + Amount; return tot data.csv",
      "args": [
        "map",
        "Total",
        "tot = (tot or 0) + Amount; return tot",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter",
            "Amount",
            "Total"
          ],
          [
            "a",
            "13",
            "13"
          ],
          [
            "b",
            "24",
            "37"
          ],
          [
            "c",
            "72",
            "109"
          ],
          [
            "d",
            "7",
            "116"
          ]
        ]
      }
    },
    {
      "name": "luau_aggregation_with_begin",
      "description": "Luau Aggregation With Begin",
      "input": {
        "data": [
          [
            "letter",
            "Amount"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map Total tot = tot + Amount; return tot data.csv",
      "args": [
        "map",
        "Total",
        "tot = tot + Amount; return tot",
        "data.csv"
      ],
      "options": {
        "--begin": "tot = 0"
      },
      "expected": {
        "data": [
          [
            "letter",
            "Amount",
            "Total"
          ],
          [
            "a",
            "13",
            "13"
          ],
          [
            "b",
            "24",
            "37"
          ],
          [
            "c",
            "72",
            "109"
          ],
          [
            "d",
            "7",
            "116"
          ]
        ]
      }
    },
    {
      "name": "luau_aggregation_with_begin_end",
      "description": "Luau Aggregation With Begin End",
      "input": {
        "data": [
          [
            "letter",
            "Amount"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map Total",
      "args": [
        "map",
        "Total"
      ],
      "options": {
        "--begin": "true"
      }
    },
    {
      "name": "luau_aggregation_with_embedded_begin_end",
      "description": "Luau Aggregation With Embedded Begin End",
      "input": {
        "data": [
          [
            "letter",
            "Amount"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map Total",
      "args": [
        "map",
        "Total"
      ]
    },
    {
      "name": "luau_aggregation_with_embedded_begin_end_and_beginend_options",
      "description": "Luau Aggregation With Embedded Begin End And Beginend Options",
      "input": {
        "data": [
          [
            "letter",
            "Amount"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map Total",
      "args": [
        "map",
        "Total"
      ],
      "options": {
        "--begin": "true"
      }
    },
    {
      "name": "luau_aggregation_with_begin_end_and_luau_syntax",
      "description": "Luau Aggregation With Begin End And Luau Syntax",
      "input": {
        "data": [
          [
            "letter",
            "Amount"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "-24"
          ],
          [
            "c",
            "-72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map Total",
      "args": [
        "map",
        "Total"
      ],
      "options": {
        "--begin": "true"
      }
    },
    {
      "name": "luau_map_remap_with_qsv_coalesce",
      "description": "Luau Map Remap With Qsv Coalesce",
      "input": {
        "data": [
          [
            "id",
            "name",
            "name_right"
          ],
          [
            "1",
            "Artur A. Mosiyan",
            ""
          ],
          [
            "2",
            "Eduard A. Aghabekyan",
            ""
          ],
          [
            "3",
            "Արամայիս Աղաբեկյան",
            "Aramais E. Aghabekyan"
          ],
          [
            "4",
            "Eleonora V. Avanesyan",
            ""
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map id,name",
      "args": [
        "map",
        "id,name"
      ],
      "options": {
        "--remap": "\"{id,qsv_coalesce(name_right,name"
      }
    },
    {
      "name": "luau_map_math",
      "description": "Luau Map Math",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map div math.floor(number / 2) data.csv",
      "args": [
        "map",
        "div",
        "math.floor(number / 2)",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter",
            "number",
            "div"
          ],
          [
            "a",
            "13",
            "6"
          ],
          [
            "b",
            "24",
            "12"
          ],
          [
            "c",
            "72",
            "36"
          ],
          [
            "d",
            "7",
            "3"
          ]
        ]
      }
    },
    {
      "name": "luau_map_require_luadate",
      "description": "Luau Map Require Luadate",
      "input": {
        "data": [
          [
            "letter",
            "number",
            "date_col"
          ],
          [
            "a",
            "13",
            "2001-09-11"
          ],
          [
            "b",
            "24",
            "1989-11-09"
          ],
          [
            "c",
            "72",
            "2008-11-04"
          ],
          [
            "d",
            "7",
            "2020-03-11"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map days_added r#\"local date = require \"./date\";local t_date = date(date_col",
      "args": [
        "map",
        "days_added",
        "r#\"local date = require \"./date\";local t_date = date(date_col"
      ]
    },
    {
      "name": "luau_map_error",
      "description": "Luau Map Error",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map div math.dancefloor(number / 2) data.csv",
      "args": [
        "map",
        "div",
        "math.dancefloor(number / 2)",
        "data.csv"
      ],
      "tags": [
        "error-handling"
      ]
    },
    {
      "name": "luau_map_header_with_nonalphanumeric_chars",
      "description": "Luau Map Header With Nonalphanumeric Chars",
      "input": {
        "data": [
          [
            "letter-column",
            "number column"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map r#\"div/column\"# r#\"col[\"letter-column\"] .. math.floor(col[\"number column\"] / 2 data.csv",
      "args": [
        "map",
        "r#\"div/column\"#",
        "r#\"col[\"letter-column\"] .. math.floor(col[\"number column\"] / 2",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter-column",
            "number column",
            "div/column"
          ],
          [
            "a",
            "13",
            "a6"
          ],
          [
            "b",
            "24",
            "b12"
          ],
          [
            "c",
            "72",
            "c36"
          ],
          [
            "d",
            "7",
            "d3"
          ]
        ]
      }
    },
    {
      "name": "luau_map_no_headers",
      "description": "Luau Map No Headers",
      "input": {
        "data": [
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map col[2] + 1",
      "args": [
        "map",
        "col[2] + 1"
      ],
      "options": {
        "--no-headers": "data.csv"
      },
      "expected": {
        "data": [
          [
            "a",
            "13",
            "14"
          ],
          [
            "b",
            "24",
            "25"
          ],
          [
            "c",
            "72",
            "73"
          ],
          [
            "d",
            "7",
            "8"
          ]
        ]
      },
      "tags": [
        "no-headers"
      ]
    },
    {
      "name": "luau_map_no_headers_multiple_new_columns",
      "description": "Luau Map No Headers Multiple New Columns",
      "input": {
        "data": [
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map",
      "args": [
        "map"
      ]
    },
    {
      "name": "luau_map_exec",
      "description": "Luau Map Exec",
      "input": {
        "data": [
          [
            "letter",
            "x"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map running_total tot = (tot or 0) + x; return tot data.csv",
      "args": [
        "map",
        "running_total",
        "tot = (tot or 0) + x; return tot",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter",
            "x",
            "running_total"
          ],
          [
            "a",
            "13",
            "13"
          ],
          [
            "b",
            "24",
            "37"
          ],
          [
            "c",
            "72",
            "109"
          ],
          [
            "d",
            "7",
            "116"
          ]
        ]
      }
    },
    {
      "name": "luau_map_exec_long_column_names",
      "description": "Luau Map Exec Long Column Names",
      "input": {
        "data": [
          [
            "the letter column",
            "the number column"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map running_total tot = (tot or 0) + col['the number column']; return tot data.csv",
      "args": [
        "map",
        "running_total",
        "tot = (tot or 0) + col['the number column']; return tot",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "the letter column",
            "the number column",
            "running_total"
          ],
          [
            "a",
            "13",
            "13"
          ],
          [
            "b",
            "24",
            "37"
          ],
          [
            "c",
            "72",
            "109"
          ],
          [
            "d",
            "7",
            "116"
          ]
        ]
      }
    },
    {
      "name": "luau_map_no_globals",
      "description": "Luau Map No Globals",
      "input": {
        "data": [
          [
            "y",
            "x"
          ],
          [
            "1",
            "13"
          ],
          [
            "2",
            "24"
          ],
          [
            "3",
            "72"
          ],
          [
            "4",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map z data.csv",
      "args": [
        "map",
        "z",
        "data.csv"
      ],
      "options": {
        "--colindex": "(x or col[1]) + 1"
      },
      "expected": {
        "data": [
          [
            "y",
            "x",
            "z"
          ],
          [
            "1",
            "13",
            "2"
          ],
          [
            "2",
            "24",
            "3"
          ],
          [
            "3",
            "72",
            "4"
          ],
          [
            "4",
            "7",
            "5"
          ]
        ]
      }
    },
    {
      "name": "luau_map_boolean",
      "description": "Luau Map Boolean",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map test tonumber(number) > 14 data.csv",
      "args": [
        "map",
        "test",
        "tonumber(number) > 14",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter",
            "number",
            "test"
          ],
          [
            "a",
            "13",
            "false"
          ],
          [
            "b",
            "24",
            "true"
          ],
          [
            "c",
            "72",
            "true"
          ],
          [
            "d",
            "7",
            "false"
          ]
        ]
      }
    },
    {
      "name": "luau_filter",
      "description": "Luau Filter",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau filter tonumber(number) > 14 data.csv",
      "args": [
        "filter",
        "tonumber(number) > 14",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ]
        ]
      }
    },
    {
      "name": "luau_filter_error",
      "description": "Luau Filter Error",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau filter tothedancenumber(number) > 14 data.csv",
      "args": [
        "filter",
        "tothedancenumber(number) > 14",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ]
      },
      "tags": [
        "error-handling"
      ]
    },
    {
      "name": "luau_filter_num",
      "description": "Luau Filter Num",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "-7"
          ],
          [
            "e",
            "0"
          ],
          [
            "f",
            "42"
          ],
          [
            "g",
            "0.0"
          ],
          [
            "h",
            "3.14"
          ],
          [
            "i",
            "0.000123"
          ],
          [
            "j",
            "-7.01"
          ],
          [
            "k",
            "0.0000"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau filter tonumber(number) data.csv",
      "args": [
        "filter",
        "tonumber(number)",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "-7"
          ],
          [
            "f",
            "42"
          ],
          [
            "h",
            "3.14"
          ],
          [
            "i",
            "0.000123"
          ],
          [
            "j",
            "-7.01"
          ]
        ]
      }
    },
    {
      "name": "luau_envvars_external",
      "description": "Luau Envvars External",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "-7"
          ],
          [
            "e",
            "0"
          ],
          [
            "f",
            "42"
          ],
          [
            "g",
            "0.0"
          ],
          [
            "h",
            "3.14"
          ],
          [
            "i",
            "0.000123"
          ],
          [
            "j",
            "-7.01"
          ],
          [
            "k",
            "0.0000"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau filter file:testenvvar.luau data.csv",
      "args": [
        "filter",
        "file:testenvvar.luau",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "f",
            "42"
          ]
        ]
      }
    },
    {
      "name": "luau_loadjson_error_missing_file",
      "description": "Luau Loadjson Error Missing File",
      "command": "qsv luau map result \n            r#\"\nBEGIN {\n    qsv_loadjson(\"config\", \"nonexistent.json\"",
      "args": [
        "map",
        "result",
        "\n            r#\"\nBEGIN {\n    qsv_loadjson(\"config\", \"nonexistent.json\""
      ],
      "tags": [
        "error-handling"
      ]
    },
    {
      "name": "luau_loadjson_error_invalid_json",
      "description": "Luau Loadjson Error Invalid Json",
      "command": "qsv luau map result \n            r#\"\nBEGIN {\n    qsv_loadjson(\"config\", \"invalid.json\"",
      "args": [
        "map",
        "result",
        "\n            r#\"\nBEGIN {\n    qsv_loadjson(\"config\", \"invalid.json\""
      ],
      "tags": [
        "error-handling"
      ]
    },
    {
      "name": "luau_cumsum_single",
      "description": "Luau Cumsum Single",
      "input": {
        "data": [
          [
            "amount"
          ],
          [
            "10"
          ],
          [
            "20"
          ],
          [
            "30"
          ],
          [
            "40"
          ],
          [
            "50"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map running_total r#\"qsv_cumsum(amount data.csv",
      "args": [
        "map",
        "running_total",
        "r#\"qsv_cumsum(amount",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "amount",
            "running_total"
          ],
          [
            "10",
            "10"
          ],
          [
            "20",
            "30"
          ],
          [
            "30",
            "60"
          ],
          [
            "40",
            "100"
          ],
          [
            "50",
            "150"
          ]
        ]
      }
    },
    {
      "name": "luau_cumsum_multiple",
      "description": "Luau Cumsum Multiple",
      "input": {
        "data": [
          [
            "revenue",
            "expenses"
          ],
          [
            "100",
            "50"
          ],
          [
            "200",
            "75"
          ],
          [
            "150",
            "80"
          ],
          [
            "300",
            "100"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map revenue_total,expenses_total,profit_total \n            r#\"{\n            qsv_cumsum(revenue, \"revenue\"",
      "args": [
        "map",
        "revenue_total,expenses_total,profit_total",
        "\n            r#\"{\n            qsv_cumsum(revenue, \"revenue\""
      ]
    },
    {
      "name": "luau_cumsum_invalid_input",
      "description": "Luau Cumsum Invalid Input",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ],
          [
            "invalid"
          ],
          [
            "20"
          ],
          [
            "bad"
          ],
          [
            "30"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map total r#\"qsv_cumsum(value data.csv",
      "args": [
        "map",
        "total",
        "r#\"qsv_cumsum(value",
        "data.csv"
      ]
    },
    {
      "name": "luau_cumprod",
      "description": "Luau Cumprod",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "2"
          ],
          [
            "3"
          ],
          [
            "4"
          ],
          [
            "5"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map running_product r#\"qsv_cumprod(value data.csv",
      "args": [
        "map",
        "running_product",
        "r#\"qsv_cumprod(value",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "value",
            "running_product"
          ],
          [
            "2",
            "2"
          ],
          [
            "3",
            "6"
          ],
          [
            "4",
            "24"
          ],
          [
            "5",
            "120"
          ]
        ]
      }
    },
    {
      "name": "luau_cummax_cummin",
      "description": "Luau Cummax Cummin",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ],
          [
            "5"
          ],
          [
            "15"
          ],
          [
            "3"
          ],
          [
            "12"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map running_max,running_min r#\"{qsv_cummax(value",
      "args": [
        "map",
        "running_max,running_min",
        "r#\"{qsv_cummax(value"
      ]
    },
    {
      "name": "luau_lag",
      "description": "Luau Lag",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ],
          [
            "20"
          ],
          [
            "30"
          ],
          [
            "40"
          ],
          [
            "50"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map lag1,lag2 \n            r#\"{\n            qsv_lag(value, 1, \"0\"",
      "args": [
        "map",
        "lag1,lag2",
        "\n            r#\"{\n            qsv_lag(value, 1, \"0\""
      ]
    },
    {
      "name": "luau_cumany_cumall",
      "description": "Luau Cumany Cumall",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ],
          [
            "0"
          ],
          [
            "15"
          ],
          [
            "0"
          ],
          [
            "20"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map has_zero,all_positive \n            r#\"{\n            qsv_cumany(value == \"0\"",
      "args": [
        "map",
        "has_zero,all_positive",
        "\n            r#\"{\n            qsv_cumany(value == \"0\""
      ]
    },
    {
      "name": "luau_diff",
      "description": "Luau Diff",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ],
          [
            "15"
          ],
          [
            "13"
          ],
          [
            "20"
          ],
          [
            "18"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map diff1,diff2 \n            r#\"{\n            qsv_diff(value",
      "args": [
        "map",
        "diff1,diff2",
        "\n            r#\"{\n            qsv_diff(value"
      ]
    },
    {
      "name": "luau_cumany_cumall_with_strings",
      "description": "Luau Cumany Cumall With Strings",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "hello"
          ],
          [
            ""
          ],
          [
            "world"
          ],
          [
            ""
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map has_empty,all_nonempty \n            r#\"{\n            qsv_cumany(value == \"\"",
      "args": [
        "map",
        "has_empty,all_nonempty",
        "\n            r#\"{\n            qsv_cumany(value == \"\""
      ]
    },
    {
      "name": "luau_cumall_with_numbers",
      "description": "Luau Cumall With Numbers",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ],
          [
            "0"
          ],
          [
            "20"
          ],
          [
            "30"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map all_positive r#\"qsv_cumall(tonumber(value data.csv",
      "args": [
        "map",
        "all_positive",
        "r#\"qsv_cumall(tonumber(value",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "value",
            "all_positive"
          ],
          [
            "10",
            "true"
          ],
          [
            "0",
            "false"
          ],
          [
            "20",
            "false"
          ],
          [
            "30",
            "false"
          ]
        ]
      }
    },
    {
      "name": "luau_lag_with_default",
      "description": "Luau Lag With Default",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ],
          [
            "20"
          ],
          [
            "30"
          ],
          [
            "40"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map prev,prev2 \n            r#\"{\n            qsv_lag(value, 1, \"N/A\"",
      "args": [
        "map",
        "prev,prev2",
        "\n            r#\"{\n            qsv_lag(value, 1, \"N/A\""
      ]
    },
    {
      "name": "luau_diff_with_lag",
      "description": "Luau Diff With Lag",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "100"
          ],
          [
            "120"
          ],
          [
            "115"
          ],
          [
            "140"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map diff1,diff2,pct_change \n            r#\"{\n            qsv_diff(value",
      "args": [
        "map",
        "diff1,diff2,pct_change",
        "\n            r#\"{\n            qsv_diff(value"
      ]
    },
    {
      "name": "luau_cumulative_stats",
      "description": "Luau Cumulative Stats",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "15"
          ],
          [
            "10"
          ],
          [
            "25"
          ],
          [
            "5"
          ],
          [
            "20"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map running_max,running_min,running_sum \n            r#\"{\n            qsv_cummax(value",
      "args": [
        "map",
        "running_max,running_min,running_sum",
        "\n            r#\"{\n            qsv_cummax(value"
      ]
    },
    {
      "name": "luau_writejson_simple",
      "description": "Luau Writejson Simple",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ],
          [
            "b",
            "24"
          ],
          [
            "c",
            "72"
          ],
          [
            "d",
            "7"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map result",
      "args": [
        "map",
        "result"
      ]
    },
    {
      "name": "luau_writejson_special_values",
      "description": "Luau Writejson Special Values",
      "input": {
        "data": [
          [
            "letter",
            "number"
          ],
          [
            "a",
            "13"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map result",
      "args": [
        "map",
        "result"
      ]
    },
    {
      "name": "luau_accumulate_custom_sum_function",
      "description": "Luau Accumulate Custom Sum Function",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ],
          [
            "20"
          ],
          [
            "30"
          ],
          [
            "40"
          ],
          [
            "50"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map accumulated \n            r#\"\n-- This is the MAIN LOOP\n-- Define a custom accumulator function that keeps a weighted sum\n-- where each new value is weighted by its position\n-- we define the function inside the MAIN LOOP to access the _IDX variable\nfunction weighted_sum(acc, x data.csv",
      "args": [
        "map",
        "accumulated",
        "\n            r#\"\n-- This is the MAIN LOOP\n-- Define a custom accumulator function that keeps a weighted sum\n-- where each new value is weighted by its position\n-- we define the function inside the MAIN LOOP to access the _IDX variable\nfunction weighted_sum(acc, x",
        "data.csv"
      ]
    },
    {
      "name": "luau_accumulate_custom_sum_function_no_initial_value",
      "description": "Luau Accumulate Custom Sum Function No Initial Value",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ],
          [
            "20"
          ],
          [
            "30"
          ],
          [
            "40"
          ],
          [
            "50"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map accumulated \n            r#\"\n-- This is the MAIN LOOP\n-- Define a custom accumulator function that keeps a weighted sum\n-- where each new value is weighted by its position\n-- we define the function inside the MAIN LOOP to access the _IDX variable\nfunction weighted_sum(acc, x data.csv",
      "args": [
        "map",
        "accumulated",
        "\n            r#\"\n-- This is the MAIN LOOP\n-- Define a custom accumulator function that keeps a weighted sum\n-- where each new value is weighted by its position\n-- we define the function inside the MAIN LOOP to access the _IDX variable\nfunction weighted_sum(acc, x",
        "data.csv"
      ]
    },
    {
      "name": "luau_accumulate_custom_sum_function_with_initial_value",
      "description": "Luau Accumulate Custom Sum Function With Initial Value",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ],
          [
            "20"
          ],
          [
            "30"
          ],
          [
            "40"
          ],
          [
            "50"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map accumulated \n            r#\"\nBEGIN {\n\n    -- Define a custom accumulator function\n    function udf_sum(acc, x",
      "args": [
        "map",
        "accumulated",
        "\n            r#\"\nBEGIN {\n\n    -- Define a custom accumulator function\n    function udf_sum(acc, x"
      ]
    },
    {
      "name": "luau_accumulate_custom_function_with_reset",
      "description": "Luau Accumulate Custom Function With Reset",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "3"
          ],
          [
            "5"
          ],
          [
            "4"
          ],
          [
            "1"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map accumulated \n            r#\"\nBEGIN {\n\n    -- Define a custom accumulator function that resets the accumulator\n    -- if the accumulated value exceeds a threshold of 7\n    function func_with_reset(acc, x",
      "args": [
        "map",
        "accumulated",
        "\n            r#\"\nBEGIN {\n\n    -- Define a custom accumulator function that resets the accumulator\n    -- if the accumulated value exceeds a threshold of 7\n    function func_with_reset(acc, x"
      ]
    },
    {
      "name": "luau_cumsum_overflow",
      "description": "Luau Cumsum Overflow",
      "command": "qsv luau map total r#\"qsv_cumsum(value data.csv",
      "args": [
        "map",
        "total",
        "r#\"qsv_cumsum(value",
        "data.csv"
      ]
    },
    {
      "name": "luau_shellcmd_invalid_command",
      "description": "Luau Shellcmd Invalid Command",
      "input": {
        "data": [
          [
            "value"
          ],
          [
            "10"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map result \n            r#\"\nBEGIN {\n    local result = qsv_shellcmd(\"rm\", \"-rf /\"",
      "args": [
        "map",
        "result",
        "\n            r#\"\nBEGIN {\n    local result = qsv_shellcmd(\"rm\", \"-rf /\""
      ]
    },
    {
      "name": "luau_string_find_with_parentheses_escaped",
      "description": "Luau String Find With Parentheses Escaped",
      "input": {
        "data": [
          [
            "No",
            "Name",
            "Points"
          ],
          [
            "1",
            "DNE (2)",
            "1"
          ],
          [
            "2",
            "Eberhard Lisse",
            "1"
          ],
          [
            "3",
            "Jane (Smith)",
            "2"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map newpoints r#\"if string.find(Name, 'DNE %(2% data.csv",
      "args": [
        "map",
        "newpoints",
        "r#\"if string.find(Name, 'DNE %(2%",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "No",
            "Name",
            "Points",
            "newpoints"
          ],
          [
            "1",
            "DNE (2)",
            "1",
            "0"
          ],
          [
            "2",
            "Eberhard Lisse",
            "1",
            "1"
          ],
          [
            "3",
            "Jane (Smith)",
            "2",
            "10"
          ]
        ]
      }
    },
    {
      "name": "luau_string_find_with_parentheses_plain_mode",
      "description": "Luau String Find With Parentheses Plain Mode",
      "input": {
        "data": [
          [
            "No",
            "Name",
            "Points"
          ],
          [
            "1",
            "DNE (2)",
            "1"
          ],
          [
            "2",
            "Eberhard Lisse",
            "1"
          ],
          [
            "3",
            "Jane (Smith)",
            "2"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau map newpoints r#\"if string.find(Name, 'DNE (2 data.csv",
      "args": [
        "map",
        "newpoints",
        "r#\"if string.find(Name, 'DNE (2",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "No",
            "Name",
            "Points",
            "newpoints"
          ],
          [
            "1",
            "DNE (2)",
            "1",
            "0"
          ],
          [
            "2",
            "Eberhard Lisse",
            "1",
            "1"
          ],
          [
            "3",
            "Jane (Smith)",
            "2",
            "10"
          ]
        ]
      }
    },
    {
      "name": "luau_string_find_special_characters_dots",
      "description": "Luau String Find Special Characters Dots",
      "input": {
        "data": [
          [
            "email",
            "valid"
          ],
          [
            "user@example.com",
            "yes"
          ],
          [
            "test@testdotcom",
            "no"
          ],
          [
            "admin@site.org",
            "yes"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau filter r#\"string.find(email, '.com', 1, true data.csv",
      "args": [
        "filter",
        "r#\"string.find(email, '.com', 1, true",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "email",
            "valid"
          ],
          [
            "user@example.com",
            "yes"
          ]
        ]
      }
    },
    {
      "name": "luau_string_find_special_characters_escaped_dots",
      "description": "Luau String Find Special Characters Escaped Dots",
      "input": {
        "data": [
          [
            "text"
          ],
          [
            "Version 1.0"
          ],
          [
            "Version 2.5"
          ],
          [
            "No version"
          ]
        ],
        "filename": "data.csv"
      },
      "command": "qsv luau filter r#\"string.find(text, '%d%.%d' data.csv",
      "args": [
        "filter",
        "r#\"string.find(text, '%d%.%d'",
        "data.csv"
      ],
      "expected": {
        "data": [
          [
            "text"
          ],
          [
            "Version 1.0"
          ],
          [
            "Version 2.5"
          ]
        ]
      }
    },
    {
      "name": "luau_string_find_issue_3089",
      "description": "Luau String Find Issue 3089",
      "input": {
        "data": [
          [
            "No",
            "Name",
            "Minutes",
            "Points"
          ],
          [
            "1",
            "DNE (2)",
            "16",
            "1"
          ],
          [
            "2",
            "Eberhard Lisse",
            "33",
            "1"
          ]
        ],
        "filename": "a.csv"
      },
      "command": "qsv luau map newpoints r#\"if string.find(Name,'DNE %(2% a.csv map newpoints r#\"if string.find(Name,'DNE (2 a.csv",
      "args": [
        "map",
        "newpoints",
        "r#\"if string.find(Name,'DNE %(2%",
        "a.csv",
        "map",
        "newpoints",
        "r#\"if string.find(Name,'DNE (2",
        "a.csv"
      ],
      "expected": {
        "data": [
          [
            "No",
            "Name",
            "Minutes",
            "Points",
            "newpoints"
          ],
          [
            "1",
            "DNE (2)",
            "16",
            "1",
            "0"
          ],
          [
            "2",
            "Eberhard Lisse",
            "33",
            "1",
            "1"
          ]
        ]
      },
      "tags": [
        "regression"
      ]
    }
  ]
}