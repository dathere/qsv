{
  "name": "qsv-apply",
  "version": "14.0.0",
  "description": "Apply series of string, date, math & currency transformations to given CSV column/s. It also has some basic NLP functions (similarity, sentiment analysis, profanity, eudex, language & name gender) detection.",
  "category": "transformation",
  "command": {
    "binary": "qsv",
    "subcommand": "apply",
    "args": [
      {
        "name": "subcommand",
        "type": "string",
        "required": true,
        "description": "Subcommand to execute. Valid values: calcconv, dynfmt, emptyreplace, operations",
        "enum": [
          "calcconv",
          "dynfmt",
          "emptyreplace",
          "operations"
        ]
      },
      {
        "name": "operations",
        "type": "string",
        "required": true,
        "description": "The operation/s to apply."
      },
      {
        "name": "column",
        "type": "string",
        "required": true,
        "description": "The column/s to apply the operations to."
      },
      {
        "name": "input",
        "type": "file",
        "required": true,
        "description": "The input file to read from. If not specified, reads from stdin."
      }
    ],
    "options": [
      {
        "flag": "--batch",
        "type": "string",
        "description": "The number of rows per batch to load into memory, before running in parallel. Automatically determined for CSV files with more than 50000 rows. Set to 0 to load all rows in one batch. Set to 1 to force batch optimization even for files with less than 50000 rows.",
        "default": "50000"
      },
      {
        "flag": "--comparand",
        "type": "string",
        "description": ""
      },
      {
        "flag": "--delimiter",
        "type": "string",
        "description": "The field delimiter for reading CSV data. Must be a single character. (default: ,)"
      },
      {
        "flag": "--formatstr",
        "type": "string",
        "description": ""
      },
      {
        "flag": "--new-column",
        "type": "string",
        "description": "Put the transformed values in a new column instead."
      },
      {
        "flag": "--no-headers",
        "type": "flag",
        "description": "When set, the first row will not be interpreted as headers."
      },
      {
        "flag": "--output",
        "type": "string",
        "description": "Write output to <file> instead of stdout."
      },
      {
        "flag": "--rename",
        "type": "string",
        "description": "New name for the transformed column."
      },
      {
        "flag": "--replacement",
        "type": "string",
        "description": ""
      }
    ]
  },
  "hints": {
    "streamable": true,
    "indexed": true,
    "memory": "constant"
  },
  "examples": [
    {
      "description": "Trim, then transform to uppercase the surname field.",
      "command": "qsv apply operations trim,upper surname file.csv"
    },
    {
      "description": "Trim, then transform to uppercase the surname field and rename the column uppercase_clean_surname.",
      "command": "qsv apply operations trim,upper surname -r uppercase_clean_surname file.csv"
    },
    {
      "description": "Trim, then transform to uppercase the surname field and save it to a new column named uppercase_clean_surname.",
      "command": "qsv apply operations trim,upper surname -c uppercase_clean_surname file.csv"
    },
    {
      "description": "Trim, then transform to uppercase the firstname and surname fields and rename the columns ufirstname and usurname.",
      "command": "qsv apply operations trim,upper firstname,surname -r ufirstname,usurname file.csv"
    },
    {
      "description": "Trim parentheses & brackets from the description field.",
      "command": "qsv apply operations mtrim description --comparand '()<>' file.csv"
    },
    {
      "description": "Replace ' and ' with ' & ' in the description field.",
      "command": "qsv apply operations replace description --comparand ' and ' --replacement ' & ' file.csv"
    },
    {
      "description": "Extract the numeric value of the Salary column in a new column named Salary_num.",
      "command": "qsv apply operations currencytonum Salary -c Salary_num file.csv"
    },
    {
      "description": "Convert the USD_Price to PHP_Price using the currency symbol \"PHP\" with a conversion rate of 60.",
      "command": "qsv apply operations numtocurrency USD_Price -C PHP -R 60 -c PHP_Price file.csv"
    },
    {
      "description": "Base64 encode the text_col column & save the encoded value into new column named encoded & decode it.",
      "command": "qsv apply operations encode64 text_col -c encoded file.csv | qsv apply operations decode64 encoded"
    },
    {
      "description": "Compute the Normalized Damerau-Levenshtein similarity of the neighborhood column to the string 'Roxbury' and save it to a new column named dln_roxbury_score.",
      "command": "qsv apply operations lower,simdln neighborhood --comparand roxbury -c dln_roxbury_score boston311.csv"
    },
    {
      "description": "You can also use this subcommand command to make a copy of a column:",
      "command": "qsv apply operations copy col_to_copy -c col_copy file.csv"
    },
    {
      "description": "Replace empty cells in file.csv Measurement column with 'None'.",
      "command": "qsv apply emptyreplace Measurement --replacement None file.csv"
    },
    {
      "description": "Replace empty cells in file.csv Measurement column with 'Unknown Measurement'.",
      "command": "qsv apply emptyreplace Measurement --replacement 'Unknown Measurement' file.csv"
    },
    {
      "description": "Replace empty cells in file.csv M1,M2 and M3 columns with 'None'.",
      "command": "qsv apply emptyreplace M1,M2,M3 --replacement None file.csv"
    },
    {
      "description": "Replace all empty cells in file.csv for columns that start with 'Measurement' with 'None'.",
      "command": "qsv apply emptyreplace '/^Measurement/' --replacement None file.csv"
    },
    {
      "description": "Replace all empty cells in file.csv for columns that start with 'observation' case insensitive with 'None'.",
      "command": "qsv apply emptyreplace --replacement None '/(?i)^observation/' file.csv"
    },
    {
      "description": "Create a new column 'mailing address' from 'house number', 'street', 'city' and 'zip-code' columns:",
      "command": "qsv apply dynfmt --formatstr '{house_number} {street}, {city} {zip_code} USA' -c 'mailing address' file.csv"
    },
    {
      "description": "Create a new column 'FullName' from 'FirstName', 'MI', and 'LastName' columns:",
      "command": "qsv apply dynfmt --formatstr 'Sir/Madam {FirstName} {MI}. {LastName}' -c FullName file.csv"
    },
    {
      "description": "Do simple arithmetic:",
      "command": "qsv apply calcconv --formatstr '{col1} + {col2} * {col3}' --new-column result file.csv"
    },
    {
      "description": "Arithmetic with support for operators like % and ^:",
      "command": "qsv apply calcconv --formatstr '{col1} % 3' --new-column remainder file.csv"
    },
    {
      "description": "Convert from one unit to another:",
      "command": "qsv apply calcconv --formatstr '{col1} Fahrenheit in Celsius\" -c metric_temperature file.csv"
    },
    {
      "description": "Mix units and conversions are automatically done for you:",
      "command": "qsv apply calcconv --formatstr '{col1}km + {col2}mi in meters' -c meters file.csv"
    },
    {
      "description": "You can append the inferred unit at the end of the result by ending the expression with '<UNIT>':",
      "command": "qsv apply calcconv --formatstr '({col1} + {col2})km to light years <UNIT>' -c light_years file.csv"
    },
    {
      "description": "You can even do complex temporal unit conversions:",
      "command": "qsv apply calcconv --formatstr '{col1}m/s + {col2}mi/h in kilometers per h' -c kms_per_h file.csv"
    },
    {
      "description": "Use math functions - see https://docs.rs/cpc/latest/cpc/enum.FunctionIdentifier.html for list of functions:",
      "command": "qsv apply calcconv --formatstr 'round(sqrt{col1}^4)! liters' -c liters file.csv"
    },
    {
      "description": "Use percentages:",
      "command": "qsv apply calcconv --formatstr '10% of abs(sin(pi)) horsepower to watts' -c watts file.csv"
    },
    {
      "description": "Use very large numbers:",
      "command": "qsv apply calcconv --formatstr '{col1} Billion Trillion * {col2} quadrillion vigintillion' -c num_atoms file.csv"
    }
  ]
}