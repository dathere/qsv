{
  "name": "qsv-fetch",
  "version": "16.0.0",
  "description": "Send/Fetch data to/from web services for every row using **HTTP Get**. Comes with HTTP/2 adaptive flow control, jaq JSON query language support, dynamic throttling (RateLimit) & caching with available persistent caching using Redis or a disk-cache.",
  "category": "utility",
  "command": {
    "subcommand": "fetch",
    "args": [
      {
        "name": "url-column",
        "type": "string",
        "required": true,
        "description": "Name of the column with the URL. Mutually exclusive with --url-template."
      },
      {
        "name": "input",
        "type": "file",
        "required": true,
        "description": ""
      }
    ],
    "options": [
      {
        "flag": "--cache-error",
        "type": "flag",
        "description": "Cache error responses even if a request fails. If an identical URL is requested, the cached error is returned. Otherwise, the fetch is attempted again for --max-retries."
      },
      {
        "flag": "--cookies",
        "type": "flag",
        "description": "Allow cookies."
      },
      {
        "flag": "--delimiter",
        "type": "string",
        "description": "The field delimiter for reading CSV data. Must be a single character. (default: ,)"
      },
      {
        "flag": "--disk-cache",
        "type": "flag",
        "description": "Use a persistent disk cache for responses. The cache is stored in the directory specified by --disk-cache-dir. If the directory does not exist, it will be created. If the directory exists, it will be used as is. It has a default Time To Live (TTL)/lifespan of 28 days and cache hits do not refresh the TTL of cached values. Adjust the QSV_DISKCACHE_TTL_SECS & QSV_DISKCACHE_TTL_REFRESH env vars to change DiskCache settings."
      },
      {
        "flag": "--disk-cache-dir",
        "type": "string",
        "description": "The directory <dir> to store the disk cache. Note that if the directory does not exist, it will be created. If the directory exists, it will be used as is, and will not be flushed. This option allows you to maintain several disk caches for different fetch jobs (e.g. one for geocoding, another for weather, etc.)",
        "default": "~/.qsv/cache/fetch"
      },
      {
        "flag": "--flush-cache",
        "type": "flag",
        "description": "Flush all the keys in the current cache on startup. This only applies to Disk and Redis caches."
      },
      {
        "flag": "--http-header",
        "type": "string",
        "description": "Append custom header(s) to the HTTP header. Pass multiple key-value pairs by adding this option multiple times, once for each pair. The key and value should be separated by a colon."
      },
      {
        "flag": "--jaq",
        "type": "string",
        "description": "Apply jaq selector to API returned JSON value. Mutually exclusive with --jaqfile,"
      },
      {
        "flag": "--jaqfile",
        "type": "string",
        "description": "Load jaq selector from file instead. Mutually exclusive with --jaq."
      },
      {
        "flag": "--max-errors",
        "type": "string",
        "description": "Maximum number of errors before aborting. Set to zero (0) to continue despite errors.",
        "default": "10"
      },
      {
        "flag": "--max-retries",
        "type": "string",
        "description": "Maximum number of retries per record before an error is raised.",
        "default": "5"
      },
      {
        "flag": "--mem-cache-size",
        "type": "string",
        "description": "Maximum number of entries in the in-memory LRU cache.",
        "default": "2000000"
      },
      {
        "flag": "--new-column",
        "type": "string",
        "description": "Put the fetched values in a new column. Specifying this option results in a CSV. Otherwise, the output is in JSONL format."
      },
      {
        "flag": "--no-cache",
        "type": "flag",
        "description": "Do not cache responses."
      },
      {
        "flag": "--no-headers",
        "type": "flag",
        "description": "When set, the first row will not be interpreted as headers. Namely, it will be sorted with the rest of the rows. Otherwise, the first row will always appear as the header row in the output."
      },
      {
        "flag": "--output",
        "type": "string",
        "description": "Write output to <file> instead of stdout."
      },
      {
        "flag": "--pretty",
        "type": "flag",
        "description": "Prettify JSON responses. Otherwise, they're minified. If the response is not in JSON format, it's passed through. Note that --pretty requires the --new-column option."
      },
      {
        "flag": "--rate-limit",
        "type": "string",
        "description": "Rate Limit in Queries Per Second (max: 1000). Note that fetch dynamically throttles as well based on rate-limit and retry-after response headers. Set to 0 to go as fast as possible, automatically throttling as required. CAUTION: Only use zero for APIs that use RateLimit and/or Retry-After headers, otherwise your fetch job may look like a Denial Of Service attack. Even though zero is the default, this is mitigated by --max-errors having a default of 10.",
        "default": "0"
      },
      {
        "flag": "--report",
        "type": "string",
        "description": "Creates a report of the fetch job. The report has the same name as the input file with the \".fetch-report\" suffix. There are two kinds of report - d for \"detailed\" & s for \"short\". The detailed report has the same columns as the input CSV with six additional columns - qsv_fetch_url, qsv_fetch_status, qsv_fetch_cache_hit, qsv_fetch_retries, qsv_fetch_elapsed_ms & qsv_fetch_response. The short report only has the six columns without the \"qsv_fetch_\" prefix.",
        "default": "none"
      },
      {
        "flag": "--store-error",
        "type": "flag",
        "description": "On error, store error code/message instead of blank value."
      },
      {
        "flag": "--timeout",
        "type": "string",
        "description": "Timeout for each URL request.",
        "default": "30"
      },
      {
        "flag": "--url-template",
        "type": "string",
        "description": "URL template to use. Use column names enclosed with curly braces to insert the CSV data for a record. Mutually exclusive with url-column."
      }
    ]
  },
  "hints": {
    "streamable": true,
    "indexed": true,
    "memory": "constant"
  }
}