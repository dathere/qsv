{
  "name": "qsv-geocode",
  "version": "13.0.0",
  "description": "Geocodes a location in CSV data against an updatable local copy of the Geonames cities index and a local copy of the MaxMind GeoLite2 City database. The Geonames cities index can be retrieved and updated using the `geocode index-*` subcommands. The GeoLite2 City database will need to be MANUALLY downloaded from MaxMind. Though it is free, you will need to create a MaxMind account to download the GeoIP2 Binary database (mmdb) from https://www.maxmind.com/en/accounts/current/geoip/downloads. Copy the GeoLite2-City.mmdb file to the ~/.qsv-cache/ directory or point to it using the QSV_GEOIP2_FILENAME environment variable. When you run the command for the first time, it will download a prebuilt Geonames cities index from the qsv GitHub repo and use it going forward. You can operate on the local index using the `geocode index-*` subcommands. By default, the prebuilt index uses the Geonames Gazeteer cities15000.zip file using English names. It contains cities with populations > 15,000 (about ~26k cities). See https://download.geonames.org/export/dump/ for more information. It has seven major subcommands: * suggest        - given a partial City name, return the closest City's location metadata per the local Geonames cities index (Jaro-Winkler distance) * suggestnow     - same as suggest, but using a partial City name from the command line, instead of CSV data. * reverse        - given a WGS-84 location coordinate, return the closest City's location metadata per the local Geonames cities index. (Euclidean distance - shortest distance \"as the crow flies\") * reversenow     - sames as reverse, but using a coordinate from the command line, instead of CSV data. * countryinfo    - returns the country information for the ISO-3166 2-letter country code (e.g. US, CA, MX, etc.) * countryinfonow - same as countryinfo, but using a country code from the command line, instead of CSV data. * iplookup       - given an IP address or URL, return the closest City's location metadata per the local Maxmind GeoLite2 City database. * iplookupnow    - same as iplookup, but using an IP address or URL from the command line, instead of CSV data. * index-*        - operations to update the local Geonames cities index. (index-check, index-update, index-load & index-reset) SUGGEST Suggest a Geonames city based on a partial city name. It returns the closest Geonames city record based on the Jaro-Winkler distance between the partial city name and the Geonames city name. The geocoded information is formatted based on --formatstr, returning it in '%location' format (i.e. \"(lat, long)\") if not specified. Use the --new-column option if you want to keep the location column:",
  "category": "utility",
  "command": {
    "binary": "qsv",
    "subcommand": "geocode",
    "args": [
      {
        "name": "column",
        "type": "string",
        "required": true,
        "description": "The column to geocode. Used by suggest, reverse & countryinfo subcommands. For suggest, it must be a column with a City string pattern. For reverse, it must be a column using WGS 84 coordinates in \"lat, long\" or \"(lat, long)\" format. For countryinfo, it must be a column with a ISO 3166-1 alpha-2 country code. For iplookup, it must be a column with an IP address or a URL. Note that you can use column selector syntax to select the column, but only the first column will be used. See `select --help` for more information."
      },
      {
        "name": "input",
        "type": "file",
        "required": true,
        "description": "The input file to read from. If not specified, reads from stdin."
      }
    ],
    "options": [
      {
        "flag": "--admin1",
        "type": "string",
        "description": "The comma-delimited, case-insensitive list of admin1s to filter for."
      },
      {
        "flag": "--batch",
        "type": "string",
        "description": "The number of rows per batch to load into memory, before running in parallel. Set to 0 to load all rows in one batch. [default: 50000]",
        "default": "50000"
      },
      {
        "flag": "--cache-dir",
        "type": "string",
        "description": "The directory to use for caching the Geonames cities index. If the directory does not exist, qsv will attempt to create it. If the QSV_CACHE_DIR envvar is set, it will be used instead. [default: ~/.qsv-cache]",
        "default": "~/.qsv-cache"
      },
      {
        "flag": "--cities-url",
        "type": "string",
        "description": "The URL to download the Geonames cities file from. There are several available at https://download.geonames.org/export/dump/. cities500.zip   - cities with populations > 500; ~200k cities, 56mb cities1000.zip  - population > 1000; ~140k cities, 44mb cities5000.zip  - population > 5000; ~53k cities, 21mb cities15000.zip - population > 15000; ~26k cities, 13mb Note that the more cities are included, the larger the local index file will be, lookup times will be slower, and the search results will be different. For convenience, if this is set to 500, 1000, 5000 or 15000, it will be converted to a geonames cities URL. [default: https://download.geonames.org/export/dump/cities15000.zip]",
        "default": "https://download.geonames.org/export/dump/cities15000.zip"
      },
      {
        "flag": "--country",
        "type": "string",
        "description": "The comma-delimited, case-insensitive list of countries to filter for. Country is specified as a ISO 3166-1 alpha-2 (two-letter) country code. https://en.wikipedia.org/wiki/ISO_3166-2"
      },
      {
        "flag": "--delimiter",
        "type": "string",
        "description": "The field delimiter for reading CSV data. Must be a single character. (default: ,)"
      },
      {
        "flag": "--force",
        "type": "flag",
        "description": "Force update the Geonames cities index. If not set, qsv will check if there are updates available at Geonames.org before updating the index."
      },
      {
        "flag": "--formatstr",
        "type": "string",
        "description": "",
        "default": "%+"
      },
      {
        "flag": "--help",
        "type": "flag",
        "description": "Display this message"
      },
      {
        "flag": "--invalid-result",
        "type": "string",
        "description": "The string to return when the geocode result is empty/invalid. If not set, the original value is used."
      },
      {
        "flag": "--jobs",
        "type": "string",
        "description": "The number of jobs to run in parallel. When not set, the number of jobs is set to the number of CPUs detected."
      },
      {
        "flag": "--k_weight",
        "type": "string",
        "description": "Use population-weighted distance for reverse subcommand. (i.e. nearest.distance - k * city.population) Larger values will favor more populated cities. If not set (default), the population is not used and the nearest city is returned."
      },
      {
        "flag": "--language",
        "type": "string",
        "description": "The language to use when geocoding. The language is specified as a ISO 639-1 code. Note that the Geonames index must have been built with the specified language using the `index-update` subcommand with the --languages option. If the language is not available, the first language in the index is used. [default: en]",
        "default": "en"
      },
      {
        "flag": "--languages",
        "type": "string",
        "description": "The comma-delimited, case-insensitive list of languages to use when building the Geonames cities index. The languages are specified as a comma-separated list of ISO 639-2 codes. See https://download.geonames.org/export/dump/iso-languagecodes.txt to look up codes and https://download.geonames.org/export/dump/alternatenames/ for the supported language files. 253 languages are currently supported. [default: en]",
        "default": "en"
      },
      {
        "flag": "--min-score",
        "type": "string",
        "description": "The minimum Jaro-Winkler distance score. [default: 0.8]",
        "default": "0.8"
      },
      {
        "flag": "--new-column",
        "type": "string",
        "description": "Put the transformed values in a new column instead. Not valid when using the '%dyncols:' --formatstr option."
      },
      {
        "flag": "--output",
        "type": "string",
        "description": "Write output to <file> instead of stdout."
      },
      {
        "flag": "--progressbar",
        "type": "flag",
        "description": "Show progress bars. Will also show the cache hit rate upon completion. Not valid for stdin."
      },
      {
        "flag": "--rename",
        "type": "string",
        "description": "New name for the transformed column."
      },
      {
        "flag": "--timeout",
        "type": "string",
        "description": "Timeout for downloading Geonames cities index. [default: 120]",
        "default": "120"
      }
    ]
  },
  "hints": {
    "streamable": true,
    "memory": "constant"
  },
  "test_file": "https://github.com/dathere/qsv/blob/master/tests/test_geocode.rs"
}